<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>TestFFTEnsembleProcessor</title>
<meta name="generator" content="MATLAB 25.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-12-10">
<meta name="DC.source" content="TestFFTEnsembleProcessor.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<pre class="codeinput">
<span class="keyword">classdef</span> TestFFTEnsembleProcessor &lt; matlab.unittest.TestCase
    <span class="comment">% Test suite for FFTEnsembleProcessor</span>

    <span class="keyword">properties</span> (Constant)
        <span class="comment">% Column/field names and test labels</span>
        ColHorizAccel = <span class="string">"HorizontalAcceleration"</span>;
        ColVertAccel  = <span class="string">"VerticalAcceleration"</span>;
        ColHorizFFT   = <span class="string">"HorizontalAcceleration_FFT"</span>;
        ColVertFFT    = <span class="string">"VerticalAcceleration_FFT"</span>;
        ColSnapshot   = <span class="string">"SnapshotIndex"</span>;
        TempMemberFmt = <span class="string">"member_%d.mat"</span>;
        DataStructField = <span class="string">"ensembleMemberTable"</span>;
        EnsembleFilesPattern = <span class="string">"member_*.mat"</span>;
        TemporalColumns = <span class="keyword">...</span>
            {<span class="string">'HorizontalAcceleration'</span>,<span class="string">'VerticalAcceleration'</span>};
        AbsTol = 1.e-10;
    <span class="keyword">end</span>

    <span class="keyword">properties</span>
        processor
        testEnsemble
        tempDir
    <span class="keyword">end</span>

    <span class="keyword">methods</span> (TestMethodSetup)
        <span class="keyword">function</span> setupTest(testCase)
            testCase.tempDir = tempname;
            mkdir(testCase.tempDir);
            <span class="keyword">for</span> k = 1:2
                tbl = table;
                tbl.(testCase.ColHorizAccel) = {randn(128,1)};
                tbl.(testCase.ColVertAccel)  = {randn(128,1)};
                tbl.(testCase.ColSnapshot)   = k;
                dataToSave = struct(testCase.DataStructField, tbl);
                save(fullfile(testCase.tempDir, <span class="keyword">...</span>
                    sprintf(testCase.TempMemberFmt, k)), <span class="keyword">...</span>
                    <span class="string">'-fromstruct'</span>, dataToSave, <span class="string">'-v7.3'</span>);
            <span class="keyword">end</span>
            files = dir(fullfile( <span class="keyword">...</span>
                testCase.tempDir, testCase.EnsembleFilesPattern));
            fileList = fullfile({files.folder}, {files.name})';
            ensembleStruct = struct(<span class="string">'Files'</span>, {fileList});
            testCase.testEnsemble = EnsembleBroker(<span class="keyword">...</span>
                ensembleObject = ensembleStruct, <span class="keyword">...</span>
                getFilesFunction = @(obj) obj.Files, <span class="keyword">...</span>
                temporalSnapshotColumns = testCase.TemporalColumns);
            testCase.processor = FFTEnsembleProcessor(<span class="keyword">...</span>
                numWorkers = 2, <span class="keyword">...</span>
                ensemble = testCase.testEnsemble);
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">methods</span> (TestMethodTeardown)
        <span class="keyword">function</span> teardownTest(testCase)
            <span class="keyword">if</span> isfolder(testCase.tempDir)
                rmdir(testCase.tempDir, <span class="string">'s'</span>);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">methods</span> (Test)
        <span class="keyword">function</span> testProcessAddsFFTColumns(testCase)
            testCase.processor.process();
            <span class="keyword">for</span> k = 1:numel(testCase.testEnsemble.ensemble.Files)
                data = load( <span class="keyword">...</span>
                    testCase.testEnsemble.ensemble.Files{k}, <span class="keyword">...</span>
                    testCase.DataStructField);
                tbl = data.(testCase.DataStructField);
                testCase.verifyTrue( <span class="keyword">...</span>
                    ismember( <span class="keyword">...</span>
                        testCase.ColHorizFFT, <span class="keyword">...</span>
                        tbl.Properties.VariableNames));
                testCase.verifyTrue(<span class="keyword">...</span>
                    ismember( <span class="keyword">...</span>
                        testCase.ColVertFFT, <span class="keyword">...</span>
                        tbl.Properties.VariableNames));
                testCase.verifyEqual( <span class="keyword">...</span>
                    length(tbl.(testCase.ColHorizFFT)), height(tbl));
                testCase.verifyEqual( <span class="keyword">...</span>
                    length(tbl.(testCase.ColVertFFT)), height(tbl));
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="keyword">function</span> testFFTValuesAreCorrect(testCase)
            testCase.processor.process();
            <span class="keyword">for</span> k = 1:numel(testCase.testEnsemble.ensemble.Files)
                data = load( <span class="keyword">...</span>
                    testCase.testEnsemble.ensemble.Files{k}, <span class="keyword">...</span>
                    testCase.DataStructField);
                tbl = data.(testCase.DataStructField);
                <span class="keyword">for</span> row = 1:height(tbl)
                    xh = tbl.(testCase.ColHorizAccel){row};
                    xv = tbl.(testCase.ColVertAccel){row};
                    testCase.verifyEqual( <span class="keyword">...</span>
                        tbl.(testCase.ColHorizFFT){row}, <span class="keyword">...</span>
                        fft(xh), <span class="string">'AbsTol'</span>, testCase.AbsTol);
                    testCase.verifyEqual( <span class="keyword">...</span>
                        tbl.(testCase.ColVertFFT){row}, <span class="keyword">...</span>
                        fft(xv), <span class="string">'AbsTol'</span>, testCase.AbsTol);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="keyword">function</span> testParallelProcessing(testCase)
            testCase.processor.process();
            testCase.assertTrue(true);
        <span class="keyword">end</span>

        <span class="keyword">function</span> testNoFilesDoesNotError(testCase)
            noMembersEnsembleStruct = struct(<span class="string">'Files'</span>, {{}});
            noMembersEnsemble = EnsembleBroker(<span class="keyword">...</span>
                ensembleObject = noMembersEnsembleStruct, <span class="keyword">...</span>
                getFilesFunction = @(obj) obj.Files, <span class="keyword">...</span>
                temporalSnapshotColumns = {});
            testCase.processor.ensemble = noMembersEnsemble;
            testCase.processor.process();
            testCase.assertTrue(true);
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2025b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
classdef TestFFTEnsembleProcessor < matlab.unittest.TestCase
    % Test suite for FFTEnsembleProcessor

    properties (Constant)
        % Column/field names and test labels
        ColHorizAccel = "HorizontalAcceleration";
        ColVertAccel  = "VerticalAcceleration";
        ColHorizFFT   = "HorizontalAcceleration_FFT";
        ColVertFFT    = "VerticalAcceleration_FFT";
        ColSnapshot   = "SnapshotIndex";
        TempMemberFmt = "member_%d.mat";
        DataStructField = "ensembleMemberTable";
        EnsembleFilesPattern = "member_*.mat";
        TemporalColumns = ...
            {'HorizontalAcceleration','VerticalAcceleration'};
        AbsTol = 1.e-10;
    end

    properties
        processor
        testEnsemble
        tempDir
    end

    methods (TestMethodSetup)
        function setupTest(testCase)
            testCase.tempDir = tempname;
            mkdir(testCase.tempDir);
            for k = 1:2
                tbl = table;
                tbl.(testCase.ColHorizAccel) = {randn(128,1)};
                tbl.(testCase.ColVertAccel)  = {randn(128,1)};
                tbl.(testCase.ColSnapshot)   = k;
                dataToSave = struct(testCase.DataStructField, tbl);
                save(fullfile(testCase.tempDir, ...
                    sprintf(testCase.TempMemberFmt, k)), ...
                    '-fromstruct', dataToSave, '-v7.3');
            end
            files = dir(fullfile( ...
                testCase.tempDir, testCase.EnsembleFilesPattern));
            fileList = fullfile({files.folder}, {files.name})';
            ensembleStruct = struct('Files', {fileList});
            testCase.testEnsemble = EnsembleBroker(...
                ensembleObject = ensembleStruct, ...
                getFilesFunction = @(obj) obj.Files, ...
                temporalSnapshotColumns = testCase.TemporalColumns);
            testCase.processor = FFTEnsembleProcessor(...
                numWorkers = 2, ...
                ensemble = testCase.testEnsemble);
        end
    end

    methods (TestMethodTeardown)
        function teardownTest(testCase)
            if isfolder(testCase.tempDir)
                rmdir(testCase.tempDir, 's');
            end
        end
    end

    methods (Test)
        function testProcessAddsFFTColumns(testCase)
            testCase.processor.process();
            for k = 1:numel(testCase.testEnsemble.ensemble.Files)
                data = load( ...
                    testCase.testEnsemble.ensemble.Files{k}, ...
                    testCase.DataStructField);
                tbl = data.(testCase.DataStructField);
                testCase.verifyTrue( ...
                    ismember( ...
                        testCase.ColHorizFFT, ...
                        tbl.Properties.VariableNames));
                testCase.verifyTrue(...
                    ismember( ...
                        testCase.ColVertFFT, ...
                        tbl.Properties.VariableNames));
                testCase.verifyEqual( ...
                    length(tbl.(testCase.ColHorizFFT)), height(tbl));
                testCase.verifyEqual( ...
                    length(tbl.(testCase.ColVertFFT)), height(tbl));
            end
        end

        function testFFTValuesAreCorrect(testCase)
            testCase.processor.process();
            for k = 1:numel(testCase.testEnsemble.ensemble.Files)
                data = load( ...
                    testCase.testEnsemble.ensemble.Files{k}, ...
                    testCase.DataStructField);
                tbl = data.(testCase.DataStructField);
                for row = 1:height(tbl)
                    xh = tbl.(testCase.ColHorizAccel){row};
                    xv = tbl.(testCase.ColVertAccel){row};
                    testCase.verifyEqual( ...
                        tbl.(testCase.ColHorizFFT){row}, ...
                        fft(xh), 'AbsTol', testCase.AbsTol);
                    testCase.verifyEqual( ...
                        tbl.(testCase.ColVertFFT){row}, ...
                        fft(xv), 'AbsTol', testCase.AbsTol);
                end
            end
        end

        function testParallelProcessing(testCase)
            testCase.processor.process();
            testCase.assertTrue(true);
        end

        function testNoFilesDoesNotError(testCase)
            noMembersEnsembleStruct = struct('Files', {{}});
            noMembersEnsemble = EnsembleBroker(...
                ensembleObject = noMembersEnsembleStruct, ...
                getFilesFunction = @(obj) obj.Files, ...
                temporalSnapshotColumns = {});
            testCase.processor.ensemble = noMembersEnsemble;
            testCase.processor.process();
            testCase.assertTrue(true);
        end
    end
end

##### SOURCE END #####
-->
</body>
</html>
